# Обзор проекта: Pancake Sorting

## Задача

**Pancake sorting** — задача сортировки перестановки префиксными разворотами. Дана перестановка `perm` длины n (числа 0..n-1). Разрешённый ход: выбрать k от 2 до n и развернуть первые k элементов (обозначение Rk). Цель — привести перестановку к тождественной [0,1,...,n-1] за минимальное число ходов.

Формат вывода: строка ходов, например `"R2.R5.R3"` (разделитель — точка).

## Источники кода

1. **pancake_91584_final_edit.py** (Colab)
   - Классический жадный pancake sort.
   - Эвристики: `gap_h`, `breakpoints2`, `mix_h`.
   - Beam search с эвристикой: `beam_improve_or_baseline_h`, грид по alpha/w/beam_width/depth.
   - ML: модели Pilgrim, SimpleMLP, EmbMLP; обучение на графе Кэли; `beam_improve_with_ml`.
   - Сабмиты: прогресс в CSV, merge частичных результатов, оценка против baseline.

2. **копия_блокнота__pancake_problem_.py** (Colab/Kaggle)
   - Базовый pancake sort с выводом в виде строк "Rk".
   - Много вариантов эвристического поиска: v1, v2, v2_1, v2_2_np, v3, v3_1 … v3_6, v4, recursive v1/v2/v3.
   - Общая идея: поиск в пространстве состояний с приоритетом по эвристике и отсечением по порогу (`treshold`).
   - Утилиты: `process_row`, `best_solution`, `revers_perm`, `check_steps`, `compare`, `prob_step`.

## Цели проекта (из постановки)

1. **Улучшить** — рефакторинг, тесты, документация, стабильность.
2. **Скрестить копию блокнота с beam search** — использовать beam search из 91584 как улучшатель решений, полученных солверами из блокнота (или наоборот).
3. **Скрестить копию блокнота с pancake_91584** — объединить утилиты, пайплайны, форматы; один конвейер из двух источников.
4. **Скрестить блокнот + beam search + pancake_91584** — полная интеграция: эвристический поиск блокнота + beam по эвристике + (опционально) ML-beam из 91584; общие форматы и тесты.

Полный перечень перенесённого функционала и оставшихся пробелов — в [docs/07_AUDIT_GAPS.md](07_AUDIT_GAPS.md).

## Термины

- **Baseline** — классический жадный pancake sort (O(n²) ходов).
- **Beam search** — поиск с ограничением по ширине луча и эвристикой f = g + w*h (g — длина пути, h — эвристика состояния).
- **Notebook search** — семейство солверов из блокнота (v3_1, v3_5, v4 и т.д.) с порогом и приоритетами.
- **ML-beam** — beam search, в котором эвристика дополнена или заменена выходом нейросети.
